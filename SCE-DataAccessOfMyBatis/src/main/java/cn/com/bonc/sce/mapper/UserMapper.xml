<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.bonc.sce.mapper.UserMapper">

    <insert id="saveUser" parameterType="cn.com.bonc.sce.bean.UserBean">
        INSERT INTO STARCLOUDPORTAL.SCE_COMMON_USER
            (USER_ID,SECRET,LOGIN_NAME,USER_TYPE,IS_DELETE,ORGANIZATION_ID,PHONE_NUMBER,USER_NAME,ACCOUNT_STATUS,CERTIFICATE_TYPE,CERTIFICATE_NUMBER)
        VALUES
            (#{userId,jdbcType=BIGINT},#{secret,jdbcType=VARCHAR},#{loginName,jdbcType=VARCHAR},
            #{userType,jdbcType=INTEGER},#{isDelete,jdbcType=INTEGER},#{organizationId,jdbcType=INTEGER},
            #{phoneNumber,jdbcType=VARCHAR},#{userName,jdbcType=VARCHAR},#{accountStatus,jdbcType=INTEGER},
            #{certificateType,jdbcType=INTEGER},#{certificateNumber,jdbcType=VARCHAR}
            )
    </insert>

    <insert id="saveAccount" parameterType="cn.com.bonc.sce.bean.AccountBean">
        INSERT INTO STARCLOUDPORTAL.SCE_COMMON_USER_PASSWORD
            (ID,PASSWORD,IS_DELETE,USER_ID)
        VALUES
            (#{id},#{password,jdbcType=VARCHAR},#{isDelete},#{userId})
    </insert>

    <select id="isExist" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE LOGIN_NAME=#{loginName}
    </select>

    <update id="delUser">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER
        SET IS_DELETE=0
        WHERE USER_ID=#{id}
    </update>

    <update id="resetPwd">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER_PASSWORD
        SET PASSWORD=#{pwd}
        WHERE USER_ID=#{id}
    </update>

    <update id="updateLoginPermission">
        UPDATE
        STARCLOUDPORTAL.SCE_COMMON_USER
        SET LOGIN_PERMISSION_STATUS = #{newStatus}
        WHERE
        USER_ID = #{id}
    </update>

    <select id="getSchools4edu" resultType="Map">
        SELECT *
        FROM STARCLOUDPORTAL.SCE_ENTITY_SCHOOL
        WHERE INSTITUTION_ID=#{id}
        AND IS_DELETE=1
    </select>

    <update id="delSchools4edu">
        UPDATE STARCLOUDPORTAL.SCE_ENTITY_SCHOOL
        SET IS_DELETE=0
        WHERE ID=#{id}
        AND INSTITUTION_ID=#{institutionId}
    </update>

    <select id="getInstitutions" resultType="Map">
        SELECT u.USER_ID,i.INSTITUTION_NAME,u.LOGIN_NAME,to_char(i.ID) as ID,u.LOGIN_PERMISSION_STATUS,
        case u.ACCOUNT_STATUS when 1 then '已激活'
        else '未激活'
        end as ACCOUNT_STATUS_DEF,NVL(u.ACCOUNT_STATUS, 0) AS ACCOUNT_STATUS,
        ROWNUM
        FROM STARCLOUDPORTAL.SCE_COMMON_USER u
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_INSTITUTION i ON u.ORGANIZATION_ID=i.ID  AND i.IS_DELETE=1
        WHERE u.IS_DELETE=1 AND u.USER_TYPE=7

        <if test="institutionName != null and institutionName!= ''" >
            AND i.INSTITUTION_NAME LIKE CONCAT(CONCAT('%',#{institutionName}),'%')
        </if>
        <if test="id != null and id!=''">
            AND i.ID=#{id}
        </if>
        <if test="loginPermissionStatus != null and loginPermissionStatus!=''" >
            AND u.LOGIN_PERMISSION_STATUS=#{loginPermissionStatus}
        </if>
        AND u.USER_TYPE=7
    </select>

    <select id="selectUserIdByLoginName" resultType="String">
        select USER_ID from STARCLOUDPORTAL.SCE_COMMON_USER WHERE LOGIN_NAME = #{LOGIN_NAME}
    </select>

    <insert id="saveUserSelective" parameterType="cn.com.bonc.sce.bean.UserBean">
        insert into STARCLOUDPORTAL.SCE_COMMON_USER
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                USER_ID,
            </if>
            <if test="loginName != null">
                LOGIN_NAME,
            </if>
            <if test="userName != null">
                USER_NAME,
            </if>
            <if test="gender != null">
                GENDER,
            </if>
            <if test="userType != null">
                USER_TYPE,
            </if>
            <if test="mailAddress != null">
                MAIL_ADDRESS,
            </if>
            <if test="certificateType != null">
                CERTIFICATE_TYPE,
            </if>
            <if test="certificateNumber != null">
                CERTIFICATE_NUMBER,
            </if>
            <if test="phoneNumber != null">
                PHONE_NUMBER,
            </if>
            <if test="address != null">
                ADDRESS,
            </if>
            <if test="createTime != null">
                CREATE_TIME,
            </if>
            <if test="loginTime != null">
                LOGIN_TIME,
            </if>
            <if test="lastLoginTime != null">
                LAST_LOGIN_TIME,
            </if>
            <if test="loginCounts != null">
                LOGIN_COUNTS,
            </if>
            <if test="organizationId != null">
                ORGANIZATION_ID,
            </if>
            <if test="loginPermissionStatus != null">
                LOGIN_PERMISSION_STATUS,
            </if>
            <if test="isDelete != null">
                IS_DELETE,
            </if>
            <if test="secret != null">
                SECRET,
            </if>
            <if test="loginTime != null">
                LOGINTIMES,
            </if>
            <if test="isFirstLogin != null">
                IS_FIRST_LOGIN,
            </if>
            <if test="headPortrait != null">
                HEAD_PORTRAIT,
            </if>
            <if test="birthday != null">
                BIRTHDATE,
            </if>
            <if test="remarks != null">
                REMARKS,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                #{userId,jdbcType=VARCHAR},
            </if>
            <if test="loginName != null">
                #{loginName,jdbcType=VARCHAR},
            </if>
            <if test="userName != null">
                #{userName,jdbcType=VARCHAR},
            </if>
            <if test="gender != null">
                #{gender,jdbcType=VARCHAR},
            </if>
            <if test="userType != null">
                #{userType,jdbcType=DECIMAL},
            </if>
            <if test="mailAddress != null">
                #{mailAddress,jdbcType=VARCHAR},
            </if>
            <if test="certificateType != null">
                #{certificateType,jdbcType=DECIMAL},
            </if>
            <if test="certificateNumber != null">
                #{certificateNumber,jdbcType=VARCHAR},
            </if>
            <if test="phoneNumber != null">
                #{phoneNumber,jdbcType=VARCHAR},
            </if>
            <if test="address != null">
                #{address,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=DATE},
            </if>
            <if test="loginTime != null">
                #{loginTime,jdbcType=DATE},
            </if>
            <if test="lastLoginTime != null">
                #{lastLoginTime,jdbcType=DATE},
            </if>
            <if test="loginCounts != null">
                #{loginCounts,jdbcType=DECIMAL},
            </if>
            <if test="organizationId != null">
                #{organizationId,jdbcType=DECIMAL},
            </if>
            <if test="loginPermissionStatus != null">
                #{loginPermissionStatus,jdbcType=DECIMAL},
            </if>
            <if test="isDelete != null">
                #{isDelete,jdbcType=DECIMAL},
            </if>
            <if test="secret != null">
                #{secret,jdbcType=VARCHAR},
            </if>
            <if test="loginTime != null">
                #{loginTime,jdbcType=DECIMAL},
            </if>
            <if test="isFirstLogin != null">
                #{isFirstLogin,jdbcType=DECIMAL},
            </if>
            <if test="headPortrait != null">
                #{headPortrait,jdbcType=VARCHAR},
            </if>
            <if test="birthday != null">
                #{birthday,jdbcType=TIMESTAMP},
            </if>
            <if test="remarks != null">
                #{remarks,jdbcType=CLOB},
            </if>
        </trim>
    </insert>
    <update id="updateUserByUserIdSelective" parameterType="cn.com.bonc.sce.bean.UserBean">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER
        <set>

            <if test="loginName != null">
                LOGIN_NAME = #{loginName,jdbcType=VARCHAR},
            </if>
            <if test="userName != null">
                USER_NAME = #{userName,jdbcType=VARCHAR},
            </if>
            <if test="gender != null">
                GENDER = #{gender,jdbcType=VARCHAR},
            </if>
            <if test="userType != null">
                USER_TYPE =  #{userType,jdbcType=DECIMAL},
            </if>
            <if test="mailAddress != null">
                MAIL_ADDRESS = #{mailAddress,jdbcType=VARCHAR},
            </if>
            <if test="certificateType != null">
                CERTIFICATE_TYPE =   #{certificateType,jdbcType=DECIMAL},
            </if>
            <if test="certificateNumber != null">
                CERTIFICATE_NUMBER = #{certificateNumber,jdbcType=VARCHAR},
            </if>
            <if test="phoneNumber != null">
                PHONE_NUMBER =  #{phoneNumber,jdbcType=VARCHAR},
            </if>
            <if test="address != null">
                ADDRESS =  #{address,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                CREATE_TIME = #{createTime,jdbcType=DATE},
            </if>
            <if test="loginTime != null">
                LOGIN_TIME = #{loginTime,jdbcType=DATE},
            </if>
            <if test="lastLoginTime != null">
                LAST_LOGIN_TIME = #{lastLoginTime,jdbcType=DATE},
            </if>
            <if test="loginCounts != null">
                LOGIN_COUNTS =   #{loginCounts,jdbcType=DECIMAL},
            </if>
            <if test="organizationId != null">
                ORGANIZATION_ID =   #{organizationId,jdbcType=DECIMAL},
            </if>
            <if test="loginPermissionStatus != null">
                LOGIN_PERMISSION_STATUS = #{loginPermissionStatus,jdbcType=DECIMAL},
            </if>
            <if test="isDelete != null">
                IS_DELETE =  #{isDelete,jdbcType=DECIMAL},
            </if>
            <if test="secret != null">
                SECRET =  #{secret,jdbcType=VARCHAR},
            </if>
            <if test="loginTime != null">
                LOGINTIMES = #{loginTime,jdbcType=DECIMAL},
            </if>
            <if test="isFirstLogin != null">
                IS_FIRST_LOGIN =  #{isFirstLogin,jdbcType=DECIMAL},
            </if>
            <if test="headPortrait != null">
                HEAD_PORTRAIT =   #{headPortrait,jdbcType=VARCHAR},
            </if>
            <if test="birthday != null">
                BIRTHDATE =   #{birthday,jdbcType=TIMESTAMP},
            </if>
            <if test="remarks != null">
                REMARKS = #{remarks,jdbcType=CLOB},
            </if>
        </set>
        where USER_ID = #{stringUserId,jdbcType=VARCHAR}
    </update>

    <select id="getPhone" resultType="Map">
        SELECT NVL(PHONE_NUMBER, (SELECT USERINFO2.PHONE_NUMBER
                                  FROM STARCLOUDPORTAL.SCE_COMMON_USER USERINFO
                                  LEFT JOIN STARCLOUDPORTAL.SCE_INFO_STUDENT_PARENT_REL REL ON USERINFO.USER_ID = REL.STUDENT_USER_ID AND REL.IS_MAIN = 1
                                  LEFT JOIN STARCLOUDPORTAL.SCE_COMMON_USER USERINFO2 ON USERINFO2.USER_ID = REL.PARENT_USER_ID
                                  WHERE USERINFO.USER_TYPE = 1 and USERINFO.IS_DELETE = 1 AND USERINFO.LOGIN_NAME = #{loginName} )
                  ) AS PHONE_NUMBER,ACCOUNT_STATUS
        FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE IS_DELETE = 1 AND LOGIN_NAME=#{loginName}
    </select>

    <update id="updatePwdByName">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER_PASSWORD
        SET PASSWORD=#{password}
        WHERE USER_ID=(SELECT USER_ID FROM STARCLOUDPORTAL.SCE_COMMON_USER WHERE LOGIN_NAME=#{loginName})
    </update>

    <update id="updateAccountStatusByName">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER
        SET ACCOUNT_STATUS=#{accountStatus}
        WHERE LOGIN_NAME=#{loginName}
    </update>

    <select id="testCertificate" resultType="java.lang.String">
        SELECT CERTIFICATE_NUMBER FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE LOGIN_NAME=#{loginName}
    </select>

    <select id="getIdByPhone" resultType="java.lang.String">
        SELECT USER_ID FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE PHONE_NUMBER=#{phone} and IS_DELETE=1
    </select>

    <select id="getTeachers" resultType="Map">
        SELECT u.USER_ID,USER_NAME,LOGIN_NAME,GENDER,PHONE_NUMBER,ACCOUNT_STATUS,
        POSITION,
        U.CERTIFICATE_TYPE,
        U.CERTIFICATE_NUMBER,
        U.MAIL_ADDRESS,
        TO_CHAR(U.BIRTHDATE,'YYYY-MM-dd') as BIRTHDATE,
        U.NATIONALITY AS NATIONLITY,
        U.VOLK AS NATION_CODE,
        T.ACADEMIC_QUALIFICATION,
        T.WORK_NUMBER,
        TO_CHAR(T.TEACH_TIME,'YYYY-MM-dd') as TEACH_TIME,
        TO_CHAR(T.SCHOOL_TIME,'YYYY-MM-dd') as SCHOOL_TIME,
        T.TEACH_RANGE,
        U.ISADMINISTRATORS
        FROM STARCLOUDPORTAL.SCE_COMMON_USER u
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_TEACHER t ON u.USER_ID=t.USER_ID AND t.IS_DELETE=1
        WHERE u.USER_TYPE=2
        AND u.IS_DELETE=1
        AND u.ORGANIZATION_ID=#{organizationId}
        <if test=" userName!= '' and userName.indexOf('%') != -1 or userName.indexOf('_') != -1">
            AND USER_NAME LIKE CONCAT(CONCAT('%#',#{userName}),'%') escape '#'
        </if>
        <if test=" userName!= '' and userName.indexOf('%') == -1 and userName.indexOf('_') == -1">
            AND USER_NAME LIKE CONCAT(CONCAT('%',#{userName}),'%')
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') != -1 or loginName.indexOf('_') != -1">
            AND LOGIN_NAME LIKE CONCAT(CONCAT('%#',#{loginName}),'%') escape '#'
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') == -1 and loginName.indexOf('_') == -1">
            AND LOGIN_NAME LIKE CONCAT(CONCAT('%',#{loginName}),'%')
        </if>
        <if test="gender != null and gender!=''" >
            AND GENDER=#{gender}
        </if>
        <if test="position != null and position!=''" >
            AND POSITION=#{position}
        </if>
        <if test="accountStatus != null and accountStatus!=''" >
            AND ACCOUNT_STATUS=#{accountStatus}
        </if>
        order by U.CREATE_TIME desc
    </select>

    <update id="delTeacher">
        UPDATE STARCLOUDPORTAL.SCE_INFO_TEACHER
        SET IS_DELETE=0
        WHERE USER_ID=#{id}
    </update>

    <select id="getTeacherInfo" resultType="Map">
        SELECT CERTIFICATE_TYPE,CERTIFICATE_NUMBER,USER_NAME,GENDER,PHONE_NUMBER,MAIL_ADDRESS,BIRTHDATE,
                NATION_CODE,NATIONLITY,ACADEMIC_QUALIFICATION,WORK_NUMBER,SCHOOL_TIME,TEACH_TIME,JOB_CODE,
                TEACH_RANGE
        FROM STARCLOUDPORTAL.SCE_COMMON_USER u , STARCLOUDPORTAL.SCE_INFO_TEACHER t
        WHERE u.USER_ID=t.USER_ID
        AND u.USER_ID=#{id} and u.IS_DELETE = 1 and t.IS_DELETE = 1
    </select>

    <update id="editUser">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER
        <set>
            <if test="certificate_type!=null">
                CERTIFICATE_TYPE=#{certificate_type},
            </if>
            <if test="certificate_number!=null">
                CERTIFICATE_NUMBER=#{certificate_number},
            </if>
            <if test="user_name!=null">
                USER_NAME=#{user_name},
            </if>
            <if test="gender!=null">
                GENDER=#{gender},
            </if>
            <if test="phone_number!=null">
                PHONE_NUMBER=#{phone_number},
            </if>
            <if test="mail_address!=null">
                MAIL_ADDRESS=#{mail_address},
            </if>
            <if test="birthdate!=null">
                BIRTHDATE=TO_DATE(#{birthdate},'YYYY-MM-dd'),
            </if>
            <if test="nationCode!=null">
                VOLK=#{nationCode},
            </if>
            <if test="nationality!=null">
                NATIONALITY=#{nationality},
            </if>
            <if test="ISADMINISTRATORS!=null">
                ISADMINISTRATORS=#{ISADMINISTRATORS}
            </if>
        </set>
        WHERE USER_ID=#{user_id}
    </update>

    <update id="editTeacher">
        UPDATE  STARCLOUDPORTAL.SCE_INFO_TEACHER
        <set>
            <if test="academic_qualification!=null">
                ACADEMIC_QUALIFICATION=#{academic_qualification},
            </if>
            <if test="work_number!=null">
                WORK_NUMBER=#{work_number},
            </if>
            <if test="school_time!=null">
                SCHOOL_TIME=TO_DATE(#{school_time},'YYYY-MM'),
            </if>
            <if test="teach_time!=null">
                TEACH_TIME=TO_DATE(#{teach_time},'YYYY-MM'),
            </if>
            <if test="position!=null">
                POSITION=#{position},
            </if>
            <if test="teach_range!=null">
                TEACH_RANGE=#{teach_range}
            </if>
        </set>
        WHERE USER_ID=#{user_id}
    </update>

    <insert id="addUser">
        INSERT INTO STARCLOUDPORTAL.SCE_COMMON_USER
        (USER_ID,CERTIFICATE_TYPE,CERTIFICATE_NUMBER,USER_NAME,
        <if test="gender != null">
            GENDER,
        </if>
        PHONE_NUMBER,ORGANIZATION_ID,
        <if test="mail_address != null">
            MAIL_ADDRESS,
        </if>
        BIRTHDATE,IS_DELETE,NATIONALITY,VOLK,SECRET,user_type,login_name)
        VALUES
        (#{user_id,jdbcType=BIGINT},#{certificate_type,jdbcType=INTEGER},#{certificate_number,jdbcType=VARCHAR},
        #{user_name,jdbcType=VARCHAR},
        <if test="gender != null">
            #{gender,jdbcType=VARCHAR},
        </if>
        #{phone_number,jdbcType=VARCHAR},#{organization_id,jdbcType=VARCHAR},
        <if test="mail_address != null">
            #{mail_address,jdbcType=VARCHAR},
        </if>
        TO_DATE(#{birthdate,jdbcType=VARCHAR},'YYYY-MM-dd'),1,#{nationality},#{nationCode},#{secret},#{userType},#{loginName})
    </insert>

    <insert id="addTeacher">
        INSERT INTO STARCLOUDPORTAL.SCE_INFO_TEACHER
        (USER_ID, ACADEMIC_QUALIFICATION,WORK_NUMBER, SCHOOL_TIME, TEACH_TIME, POSITION, TEACH_RANGE,IS_DELETE)
        VALUES
        (#{user_id},#{academic_qualification},#{work_number},TO_DATE(#{school_time},'YYYY-MM'),
        TO_DATE(#{teach_time},'YYYY-MM'),#{position},TO_NUMBER(#{teach_range}),1)
    </insert>

    <insert id="transInto">
        INSERT INTO STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        (ID,USER_ID,USER_TYPE,ORIGIN_SCHOOL_ID,TARGET_SCHOOL_ID,APPLY_STATUS,APPLY_TIME,APPLY_USER_ID,IS_DELETE,
        TEA_ENTRANCE_YEAR,TEA_WORK_NUMBER,TEA_POSITION,TEACH_RANGE)
        VALUES
        (#{id,jdbcType=BIGINT},#{user_id,jdbcType=BIGINT},2,#{origin_school_id,jdbcType=VARCHAR},
        #{target_school_id,jdbcType=VARCHAR},0,SYSDATE,#{apply_user_id,jdbcType=VARCHAR},1,
        (#{entrance_year,jdbcType=DATE}),#{tea_work_number,jdbcType=VARCHAR},
        #{tea_position,jdbcType=VARCHAR},#{tea_range,jdbcType=VARCHAR})
    </insert>

    <select id="getTransferTeachers" resultType="Map">
        SELECT u.USER_ID,USER_NAME,LOGIN_NAME,GENDER,PHONE_NUMBER,a.APPLY_STATUS,POSITION,S1.SCHOOL_NAME AS OLD_SCHOOL_NAME,A.REJECT_REASON,
        U.ACCOUNT_STATUS,S2.SCHOOL_NAME AS NEW_SCHOOL_NAME,TO_CHAR(A.ID) AS TRANSFER_ID
        FROM STARCLOUDPORTAL.SCE_COMMON_USER u
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_TEACHER t ON u.USER_ID=t.USER_ID AND t.IS_DELETE=1
        LEFT JOIN STARCLOUDPORTAL.SCE_TRANSFER_APPLY a ON  u.USER_ID=a.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL S1
        ON U.ORGANIZATION_ID = S1.ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL S2
        ON A.TARGET_SCHOOL_ID = S2.ID
        WHERE u.USER_TYPE=2
        AND u.IS_DELETE=1
        <if test="getType == 2" >
            AND TARGET_SCHOOL_ID = #{organizationId}
            AND A.APPLY_STATUS != 1
        </if>
        <if test="getType == 1" >
            AND ORIGIN_SCHOOL_ID = #{organizationId}
            AND A.APPLY_STATUS = 0
        </if>
        <if test=" userName!= '' and userName.indexOf('%') != -1 or userName.indexOf('_') != -1">
            AND USER_NAME LIKE CONCAT(CONCAT('%#',#{userName}),'%') escape '#'
        </if>
        <if test=" userName!= '' and userName.indexOf('%') == -1 and userName.indexOf('_') == -1">
            AND USER_NAME LIKE CONCAT(CONCAT('%',#{userName}),'%')
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') != -1 or loginName.indexOf('_') != -1">
            AND LOGIN_NAME LIKE CONCAT(CONCAT('%#',#{loginName}),'%') escape '#'
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') == -1 and loginName.indexOf('_') == -1">
            AND LOGIN_NAME LIKE CONCAT(CONCAT('%',#{loginName}),'%')
        </if>
        <if test="gender != null and gender!=''" >
            AND GENDER=#{gender}
        </if>
        <if test="position != null and position!=''" >
            AND POSITION=#{position}
        </if>
        <if test="accountStatus != null and accountStatus!=''" >
            AND ACCOUNT_STATUS=#{accountStatus}
        </if>
        <if test="applyStatus != null and applyStatus!=''" >
            AND APPLY_STATUS=#{applyStatus}
        </if>
        order by A.APPLY_TIME DESC
    </select>

    <select id="getStudents" resultType="Map">
        SELECT U.USER_ID,
        U.USER_NAME,
        U.LOGIN_NAME,
        U.GENDER,
        T.GRADE,
        T.CLASS_NUMBER,
        T.STUDENT_NUMBER,
        U.ACCOUNT_STATUS,
        to_char(T.ENTRANCE_YEAR,'yyyy-MM') as ENTRANCE_YEAR,
        U.CERTIFICATE_TYPE,
        U.CERTIFICATE_NUMBER,
        to_char(U.BIRTHDATE,'yyyy-MM-dd') as BIRTHDATE,
        U.NATIONALITY,
        U.VOLK,
        T.STUDENT_CODE,
        T.SEAT_NUMBER
        FROM STARCLOUDPORTAL.SCE_COMMON_USER U
        INNER JOIN STARCLOUDPORTAL.SCE_INFO_STUDENT T
        ON U.USER_ID = T.USER_ID
        where U.ORGANIZATION_ID = #{organizationId}
        AND U.USER_TYPE = 1
        AND U.IS_DELETE = 1 AND T.IS_DELETE = 1
        <if test=" userName!= '' and userName.indexOf('%') != -1 or userName.indexOf('_') != -1">
            AND U.USER_NAME LIKE CONCAT(CONCAT('%#',#{userName}),'%') escape '#'
        </if>
        <if test=" userName!= '' and userName.indexOf('%') == -1 and userName.indexOf('_') == -1">
            AND U.USER_NAME LIKE CONCAT(CONCAT('%',#{userName}),'%')
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') != -1 or loginName.indexOf('_') != -1">
            AND U.LOGIN_NAME LIKE CONCAT(CONCAT('%#',#{loginName}),'%') escape '#'
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') == -1 and loginName.indexOf('_') == -1">
            AND U.LOGIN_NAME LIKE CONCAT(CONCAT('%',#{loginName}),'%')
        </if>
        <if test="studentNumber != null and studentNumber != ''">
          and T.STUDENT_NUMBER = #{studentNumber}
        </if>
        <if test="gender != null and gender != ''">
          and U.GENDER = #{gender}
        </if>
        <if test="grade != null and grade != ''">
          and T.GRADE = #{grade}
        </if>
        <if test="accountStatus != null and accountStatus != ''">
          and U.ACCOUNT_STATUS = #{accountStatus}
        </if>
        order by U.CREATE_TIME desc
    </select>

    <select id="getOrganizationIdByUserId" resultType="String">
        SELECT ORGANIZATION_ID
        FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE USER_ID = #{userId}
        AND IS_DELETE = 1
    </select>

    <select id="getStudentInfo" resultType="Map">
        SELECT U.USER_ID,
        U.CERTIFICATE_TYPE,
        U.CERTIFICATE_NUMBER,
        U.USER_NAME,
        U.GENDER,
        U.BIRTHDATE,
        U.NATIONALITY,
        U.VOLK,
        T.STUDENT_CODE,
        to_char(T.ENTRANCE_YEAR,'yyyy-MM-dd') as ENTRANCE_YEAR,
        T.GRADE,
        T.CLASS_NUMBER,
        T.STUDENT_NUMBER
        FROM STARCLOUDPORTAL.SCE_COMMON_USER U
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_STUDENT T
        ON U.USER_ID = T.USER_ID
        WHERE U.USER_ID = #{userId} AND U.IS_DELETE = 1 AND T.IS_DELETE = 1
    </select>

    <update id="editStudentOfUser">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER
        <set>
            <if test="VOLK != null and VOLK != ''">
                VOLK = #{VOLK},
            </if>
            <if test="NATIONALITY != null and NATIONALITY != ''">
                NATIONALITY = #{NATIONALITY}
            </if>
        </set>
        WHERE USER_ID = #{USER_ID}
        and USER_TYPE = 1 AND IS_DELETE = 1
    </update>

    <update id="editStudentOfStudent">
        UPDATE STARCLOUDPORTAL.SCE_INFO_STUDENT
        <set>
            <if test="ENTRANCE_YEAR != null and ENTRANCE_YEAR != ''">
                ENTRANCE_YEAR = TO_DATE(#{ENTRANCE_YEAR},'YYYY-MM'),
            </if>
            <if test="GRADE != null and GRADE != ''">
                GRADE = #{GRADE},
            </if>
            <if test="CLASS_NUMBER != null and CLASS_NUMBER != ''">
                CLASS_NUMBER = #{CLASS_NUMBER},
            </if>
            <if test="STUDENT_NUMBER != null and STUDENT_NUMBER != ''">
                STUDENT_NUMBER = #{STUDENT_NUMBER},
            </if>
            <if test="SEAT_NUMBER != null and SEAT_NUMBER != ''">
                SEAT_NUMBER = #{SEAT_NUMBER}
            </if>
        </set>
        WHERE USER_ID = #{USER_ID}
        AND IS_DELETE = 1
    </update>

    <update id="delStudentOfStudent">
        update STARCLOUDPORTAL.SCE_INFO_STUDENT
        set  is_delete = 0
        where  USER_ID = #{userId} and is_delete = 1
    </update>

    <update id="delStudentOfUser">
        update STARCLOUDPORTAL.SCE_COMMON_USER
        set  is_delete = 0
        where  USER_ID = #{userId} and is_delete = 1
    </update>


    <update id="editTeacherPracticeInfo">
        UPDATE  STARCLOUDPORTAL.SCE_INFO_TEACHER
        <set>
            <if test="teach_certification!=null">
                TEACH_CERTIFICATION=#{teach_certification},
            </if>
            <if test="teach_time!=null">
                TEACH_TIME=#{teach_time},
            </if>
            <if test="school_time!=null">
                SCHOOL_TIME=#{school_time},
            </if>
            <if test="job_profession!=null">
                JOB_PROFESSION=#{job_profession},
            </if>
            <if test="teach_range!=null">
                TEACH_RANGE=#{teach_range},
            </if>
            <if test="work_number!=null">
                WORK_NUMBER=#{work_number}
            </if>
        </set>
        WHERE USER_ID=#{user_id}
    </update>

    <select id="selectParentInfoByCertificationNumber" resultType="Map">
        SELECT USER_NAME,GENDER,NATIONALITY,TO_CHAR(BIRTHDATE,'YYYY-MM-dd') as BIRTHDATE,VOLK,PHONE_NUMBER,MAIL_ADDRESS
        FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE IS_DELETE = 1 AND CERTIFICATE_NUMBER = #{certificationNumber}
        AND CERTIFICATE_TYPE = #{certificationType}
    </select>

    <select id="selectStudentInfoByCertificationNumber" resultType="Map">
        SELECT U.USER_NAME,U.GENDER,TO_CHAR(U.BIRTHDATE,'YYYY-MM-dd') as BIRTHDATE,NATIONALITY,VOLK,S.STUDENT_CODE
        FROM STARCLOUDPORTAL.SCE_COMMON_USER U
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_STUDENT S
        ON U.USER_ID = S.USER_ID
        WHERE U.IS_DELETE = 1 AND S.IS_DELETE = 1
        AND U.CERTIFICATE_NUMBER = #{certificationNumber}
        AND U.CERTIFICATE_TYPE = #{certificationType}
    </select>

    <select id="selectTeacherInfoByCertificationNumber" resultType="Map">
        SELECT U.USER_NAME,U.GENDER,U.NATIONALITY,TO_CHAR(U.BIRTHDATE,'YYYY-MM-dd') as BIRTHDATE,U.VOLK,U.PHONE_NUMBER,U.USER_ID,U.ORGANIZATION_ID,
        U.MAIL_ADDRESS,U.EDUCATIONAL_BACKGROUND,TO_CHAR(T.TEACH_TIME,'YYYY-MM-dd') as TEACH_TIME
        FROM STARCLOUDPORTAL.SCE_COMMON_USER U
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_TEACHER T
        ON U.USER_ID = T.USER_ID
        WHERE U.IS_DELETE = 1 AND U.CERTIFICATE_NUMBER = #{certificationNumber}
        AND U.CERTIFICATE_TYPE = #{certificationType}
    </select>

    <insert id="insertUserPassword">
        INSERT INTO STARCLOUDPORTAL.SCE_COMMON_USER_PASSWORD(ID, USER_ID, PASSWORD)
        VALUES(#{id}, #{userId}, #{password})
    </insert>

    <insert id="saveUserOfStudent">
        INSERT INTO STARCLOUDPORTAL.SCE_COMMON_USER(USER_ID, LOGIN_NAME, USER_NAME,
         <if test="studentGender != null and studentGender != ''">
             GENDER,
         </if>
         USER_TYPE, CERTIFICATE_TYPE, CERTIFICATE_NUMBER, ORGANIZATION_ID, SECRET, BIRTHDATE, ISADMINISTRATORS, NATIONALITY, VOLK)
        VALUES(#{studentId}, #{studentLoginName}, #{studentUserName},
        <if test="studentGender != null and studentGender != ''">
            #{studentGender},
        </if>
        #{userType}, #{studentCertificateType}, #{studentCertificateNumber}, #{organizationId}, #{studentSecret}, TO_DATE(#{studentBirthDate},'YYYY-MM-dd'), 0, #{studentNationality}, #{studentVolk}
        )
    </insert>

    <insert id="saveStudent">
        INSERT INTO STARCLOUDPORTAL.SCE_INFO_STUDENT(USER_ID, CLASS_NUMBER, GRADE, STUDENT_NUMBER, ENTRANCE_YEAR, SEAT_NUMBER
        <if test="studentCode != null and studentCode != ''">
            , STUDENT_CODE
        </if>
        )
        VALUES(#{studentId}, #{classNumber}, #{grade}, #{studentNumber}, TO_DATE(#{entranceYear}, 'YYYY-MM'), #{seatNumber}
        <if test="studentCode != null and studentCode != ''">
            , #{studentCode}
        </if>
        )
    </insert>

    <insert id="saveUserOfParent">
        INSERT INTO STARCLOUDPORTAL.SCE_COMMON_USER(USER_ID, LOGIN_NAME, USER_NAME,
        <if test="parentGender != null and parentGender != ''">
            GENDER,
        </if>
        USER_TYPE,
        <if test="parentMailAddress != null and parentMailAddress != ''">
            MAIL_ADDRESS,
        </if>
        PHONE_NUMBER, CERTIFICATE_TYPE, CERTIFICATE_NUMBER, SECRET, ISADMINISTRATORS, NATIONALITY, VOLK)
        VALUES(#{parentId}, #{parentLoginName}, #{parentUserName},
        <if test="parentGender != null and parentGender != ''">
            #{parentGender},
        </if>
        #{userType},
        <if test="parentMailAddress != null and parentMailAddress != ''">
            #{parentMailAddress},
        </if>
        #{parentPhoneNumber}, #{parentCertificateType}, #{parentCertificateNumber}, #{parentSecret}, 0, #{parentNationality}, #{parentVolk}
        )
    </insert>

    <insert id="saveParentStudentRel">
        INSERT INTO STARCLOUDPORTAL.SCE_INFO_STUDENT_PARENT_REL(ID, PARENT_USER_ID, STUDENT_USER_ID, IS_MAIN, RELATIONSHIP)
        VALUES(#{id}, #{parentUserId}, #{studentUserId}, #{isMain}, #{relationship})
    </insert>

    <select id="selectUserIdAndOrganizationId" resultType="Map">
        SELECT USER_ID,ORGANIZATION_ID FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE CERTIFICATE_NUMBER = #{certificateNumber}
        AND CERTIFICATE_TYPE = #{certificateType}
        <if test="userType != null and userType != ''">
            AND USER_TYPE = #{userType}
        </if>
        and IS_DELETE = 1
    </select>

    <insert id="addTransfer">
        INSERT INTO STARCLOUDPORTAL.SCE_TRANSFER_APPLY(ID, USER_ID, USER_TYPE, ORIGIN_SCHOOL_ID, TARGET_SCHOOL_ID,
        APPLY_STATUS, APPLY_USER_ID, APPLY_TIME, STU_ENTRANCE_YEAR, STU_CLASS_NUMBER, STU_GRADE, STU_SEAT_NUMBER, STUDENT_NUMBER)
        VALUES(#{id}, #{userId}, #{userType}, #{originSchoolId}, #{targetSchoolId}, 0, #{applyUserId}, SYSDATE, TO_DATE(#{entranceYear},'YYYY-MM'),
        #{classNumber}, #{grade}, #{seatNumber}, #{studentNumber})
    </insert>

    <select id="selectTransferInStudent" resultType="Map">
        SELECT TO_CHAR(TA.ID) AS TRANSFER_ID,
        U.USER_NAME,
        U.LOGIN_NAME,
        U.GENDER,
        TA.STU_GRADE AS GRADE,
        TA.STUDENT_NUMBER,
        ES.SCHOOL_NAME,
        TA.APPLY_STATUS,
        TA.REJECT_REASON,
        ES2.SCHOOL_NAME AS OLD_SCHOOL_NAME
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY TA
        LEFT JOIN STARCLOUDPORTAL.SCE_COMMON_USER U
        ON TA.USER_ID = U.USER_ID AND U.USER_TYPE = TA.USER_TYPE AND U.ORGANIZATION_ID = TA.ORIGIN_SCHOOL_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES
        ON U.ORGANIZATION_ID = ES.ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES2
        ON TA.ORIGIN_SCHOOL_ID = ES2.ID
        WHERE TA.APPLY_STATUS != 1
        AND TA.IS_DELETE = 1
        AND U.IS_DELETE = 1
        AND TA.USER_TYPE = 1
        AND ES.IS_DELETE = 1
        AND ES2.IS_DELETE = 1
        AND TA.TARGET_SCHOOL_ID = #{organizationId}
        <if test=" userName!= '' and userName.indexOf('%') != -1 or userName.indexOf('_') != -1">
            AND U.USER_NAME LIKE CONCAT(CONCAT('%#',#{userName}),'%') escape '#'
        </if>
        <if test=" userName!= '' and userName.indexOf('%') == -1 and userName.indexOf('_') == -1">
            AND U.USER_NAME LIKE CONCAT(CONCAT('%',#{userName}),'%')
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') != -1 or loginName.indexOf('_') != -1">
            AND U.LOGIN_NAME LIKE CONCAT(CONCAT('%#',#{loginName}),'%') escape '#'
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') == -1 and loginName.indexOf('_') == -1">
            AND U.LOGIN_NAME LIKE CONCAT(CONCAT('%',#{loginName}),'%')
        </if>
        <if test="gender != null and gender != ''">
            AND U.GENDER = #{gender}
        </if>
        <if test="studentNumber != null and studentNumber != ''">
            AND TA.STUDENT_NUMBER = #{studentNumber}
        </if>
        <if test="grade != null and grade != ''">
            AND TA.STU_GRADE = #{grade}
        </if>
        <if test="applyStatus != null and applyStatus != ''">
            AND TA.APPLY_STATUS = #{applyStatus}
        </if>
        ORDER BY TA.APPLY_TIME DESC
    </select>

    <select id="selectTransferOutStudent" resultType="Map">
        SELECT TO_CHAR(TA.ID) AS ID,
        U.USER_ID,
        U.USER_NAME,
        U.LOGIN_NAME,
        U.GENDER,
        ES.SCHOOL_NAME AS NEW_SCHOOL_NAME,
        TA.APPLY_STATUS,
        U.CERTIFICATE_TYPE,
        U.CERTIFICATE_NUMBER,
        TO_CHAR(U.BIRTHDATE,'YYYY-MM-dd') AS BIRTHDATE,
        U.NATIONALITY,
        U.VOLK,
        S.STUDENT_CODE,
        TO_CHAR(S.ENTRANCE_YEAR,'YYYY-MM-dd') AS ENTRANCE_YEAR,
        S.GRADE,
        S.CLASS_NUMBER,
        ES2.SCHOOL_NAME,
        S.STUDENT_NUMBER
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY TA
        LEFT JOIN STARCLOUDPORTAL.SCE_COMMON_USER U
        ON TA.USER_ID = U.USER_ID AND U.USER_TYPE = TA.USER_TYPE AND U.ORGANIZATION_ID = TA.ORIGIN_SCHOOL_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_STUDENT S
        ON S.USER_ID = U.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES
        ON TA.TARGET_SCHOOL_ID = ES.ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES2
        ON TA.ORIGIN_SCHOOL_ID = ES2.ID
        WHERE TA.APPLY_STATUS = 0
        AND TA.IS_DELETE = 1
        AND U.IS_DELETE = 1
        AND S.IS_DELETE = 1
        AND TA.USER_TYPE = 1
        AND TA.ORIGIN_SCHOOL_ID = #{organizationId}
        <if test=" userName!= '' and userName.indexOf('%') != -1 or userName.indexOf('_') != -1">
            AND U.USER_NAME LIKE CONCAT(CONCAT('%#',#{userName}),'%') escape '#'
        </if>
        <if test=" userName!= '' and userName.indexOf('%') == -1 and userName.indexOf('_') == -1">
            AND U.USER_NAME LIKE CONCAT(CONCAT('%',#{userName}),'%')
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') != -1 or loginName.indexOf('_') != -1">
            AND U.LOGIN_NAME LIKE CONCAT(CONCAT('%#',#{loginName}),'%') escape '#'
        </if>
        <if test=" loginName!= '' and loginName.indexOf('%') == -1 and loginName.indexOf('_') == -1">
            AND U.LOGIN_NAME LIKE CONCAT(CONCAT('%',#{loginName}),'%')
        </if>
        <if test="gender != null and gender != ''">
            AND U.GENDER = #{gender}
        </if>
        <if test="studentNumber != null and studentNumber != ''">
            AND S.STUDENT_NUMBER = #{studentNumber}
        </if>
        <if test="grade != null and grade != ''">
            AND S.GRADE = #{grade}
        </if>
        ORDER BY TA.APPLY_TIME DESC
    </select>

    <delete id="deleteTransferApply">
        delete from STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        where ID = #{id}
        AND TARGET_SCHOOL_ID = #{organizationId}
        AND IS_DELETE = 1
    </delete>

    <select id="selectTransfer" resultType="int">
        SELECT count(1)
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        WHERE USER_ID = #{userId}
        AND TARGET_SCHOOL_ID = #{organizationId}
        AND IS_DELETE = 1
    </select>

    <update id="reCall">
        UPDATE STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        SET APPLY_STATUS = 0
        WHERE ID = TO_NUMBER(#{transferId})
        AND IS_DELETE = 1
    </update>

    <select id="selectTransferInfo" resultType="Map">
        SELECT U.CERTIFICATE_TYPE,
        U.CERTIFICATE_NUMBER,
        U.USER_NAME,
        U.GENDER,
        TO_CHAR(U.BIRTHDATE,'YYYY-MM-dd') AS BIRTHDATE,
        U.VOLK,
        U.NATIONALITY,
        S.STUDENT_CODE,
        S.ENTRANCE_YEAR,
        S.GRADE,
        S.CLASS_NUMBER,
        S.STUDENT_NUMBER,
        ES.SCHOOL_NAME
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY TA
        LEFT JOIN STARCLOUDPORTAL.SCE_COMMON_USER U
        ON U.USER_ID = TA.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_STUDENT S
        ON S.USER_ID = U.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES
        ON ES.ID = TA.TARGET_SCHOOL_ID
        AND U.IS_DELETE = 1
        AND TA.IS_DELETE = 1
        WHERE TA.ID = #{id}
    </select>

    <update id="auditTransfer">
        UPDATE STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        SET APPLY_STATUS = #{applyStatus}
        <if test="rejectReason != null and rejectReason != ''">
          ,REJECT_REASON = #{rejectReason}
        </if>
        <if test="applyStatus == 1">
          ,IS_DELETE = 0
        </if>
        WHERE ID = #{id}
        AND IS_DELETE = 1
        AND ORIGIN_SCHOOL_ID = #{organizationId}
    </update>

    <select id="selectUserIdAndOrganizationIdByTransferId" resultType="Map">
        select TARGET_SCHOOL_ID as ORGANIZATION_ID,USER_ID
        from  STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        where ID = #{transferId}
    </select>

    <update id="updateOrganizationId">
        UPDATE STARCLOUDPORTAL.SCE_COMMON_USER
        SET ORGANIZATION_ID = #{organizationId}
        <if test="TEA_ISADMINISTRATORS != null">
            ,ISADMINISTRATORS= #{TEA_ISADMINISTRATORS}
        </if>
        WHERE USER_ID = #{userId}
    </update>

    <select id="selectStudentInfoByTransferId" resultType="Map">
        SELECT USER_ID,
        STU_ENTRANCE_YEAR,
        STU_CLASS_NUMBER,
        STU_GRADE,
        STU_SEAT_NUMBER,
        STUDENT_NUMBER
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        WHERE ID = #{transferId}
    </select>

    <update id="updateStudent">
        UPDATE STARCLOUDPORTAL.SCE_INFO_STUDENT
        <set>
            <if test="STU_ENTRANCE_YEAR != null">
                 ENTRANCE_YEAR = #{STU_ENTRANCE_YEAR},
            </if>
            <if test="STU_CLASS_NUMBER != null">
                CLASS_NUMBER = #{STU_CLASS_NUMBER},
            </if>
            <if test="STU_GRADE != null">
                GRADE = #{STU_GRADE},
            </if>
            <if test="STU_SEAT_NUMBER != null">
                SEAT_NUMBER = #{STU_SEAT_NUMBER},
            </if>
            <if test="STUDENT_NUMBER != null">
                STUDENT_NUMBER = #{STUDENT_NUMBER}
            </if>
        </set>
        WHERE USER_ID = #{USER_ID}
    </update>

    <insert id="addTeacherInfo">
        insert into STARCLOUDPORTAL.SCE_INFO_TEACHER
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="user_id != null">
                USER_ID,
            </if>
            <if test="teach_certification != null">
                TEACH_CERTIFICATION,
            </if>
            <if test="teach_time != null">
                TEACH_TIME,
            </if>
            <if test="school_time != null">
                SCHOOL_TIME,
            </if>
            <if test="job_profession != null">
                JOB_PROFESSION,
            </if>
            <if test="teach_range != null">
                TEACH_RANGE,
            </if>
            <if test="work_number != null">
                WORK_NUMBER,
            </if>
            <if test="is_delete != null">
                IS_DELETE,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="user_id != null">
                #{user_id,jdbcType=VARCHAR},
            </if>
            <if test="teach_certification != null">
                #{teach_certification,jdbcType=VARCHAR},
            </if>
            <if test="teach_time != null">
                #{teach_time,jdbcType=DATE},
            </if>
            <if test="school_time != null">
                #{school_time,jdbcType=DATE},
            </if>
            <if test="job_profession != null">
                #{job_profession,jdbcType=VARCHAR},
            </if>
            <if test="teach_range != null">
                #{teach_range,jdbcType=DECIMAL},
            </if>
            <if test="work_number != null">
                #{work_number,jdbcType=VARCHAR},
            </if>
            <if test="is_delete != null">
                #{is_delete,jdbcType=DECIMAL},
            </if>
        </trim>
    </insert>

    <select id="getUserById" resultType="cn.com.bonc.sce.bean.UserBean">
        SELECT
        T.USER_ID "stringUserId",
        T.LOGIN_NAME "loginName",
        T.USER_NAME "userName",
        T.GENDER "gender",
        T.USER_TYPE "userType",
        T.MAIL_ADDRESS "mailAddress",
        T.CERTIFICATE_TYPE "certificateType",
        T.CERTIFICATE_NUMBER "certificateNumber",
        T.PHONE_NUMBER "phoneNumber",
        T.ADDRESS "address",
        T.CREATE_TIME "createTime",
        T.LOGIN_TIME "loginTime",
        T.LAST_LOGIN_TIME "lastLoginTime",
        T.LOGIN_COUNTS "loginCounts",
        T.ORGANIZATION_ID "organizationId",
        T.LOGIN_PERMISSION_STATUS "loginPermissionStatus",
        T.IS_DELETE "isDelete",
        T.SECRET "secret",
        T.LOGINTIMES "loginTimes",
        T.IS_FIRST_LOGIN "isFirstLogin",
        T.HEAD_PORTRAIT "headPortrait",
        T.BIRTHDATE "birthday",
        T.ISADMINISTRATORS "isAdministrators",
        T.ACCOUNT_STATUS "accountStatus",
        T.NATIONALITY "nationality",
        T.VOLK "volk",
        T.EDUCATIONAL_BACKGROUND "educationalBackground"
        FROM STARCLOUDPORTAL.SCE_COMMON_USER T
        WHERE USER_ID = #{userId}
    </select>

    <select id="getTeacherInfoById" resultType="cn.com.bonc.sce.bean.TeacherInfoBean">
        SELECT
        T.USER_ID "userId",
        T.SCHOOL_ID "schoolId",
        T.POSITION "position",
        T.SUBJECT "subject",
        T.SCHOOL_AGE "schoolAge",
        T.IS_DELETE "isDelete",
        T.NAME_SPELL "nameSpell",
        T.BIRTH_DATE "birthDate",
        T.WORK_NUMBER "workNumber",
        T.MARRIAGE_CODE "marriageCode",
        T.POLITICS_STATUS "politicsStatus",
        T.BIRTH_PLACE "birthPlace",
        T.ACCOUNT_AREA_CODE "accountAreaCode",
        T.ACCOUNT_CLASS_CODE "accountClassCode",
        T.ADDRESS_MAIL_CODE "addressMailCode",
        T.SCHOOL_TIME "schoolTime",
        T.COMPILE_CODE "compileCode",
        T.ACCOUNT_CODE "accountCode",
        T.JOB_CODE "jobCode",
        T.RECORD_CODE "recordCode",
        T.IS_PART_TIME "isPartTime",
        T.IS_DOUBLE_CODE "isDoubleCode",
        T.NOW_CODE "nowCode",
        T.TEACH_TIME "teachTime",
        T.ACADEMIC_QUALIFICATION "academicQualification",
        T.TEACH_RANGE "teachRange",
        T.TEACH_CERTIFICATION "teachCertification",
        T.JOB_PROFESSION "jobProfession",
        CASE WHEN (A.AUDIT_STATUS = 1 AND A.USER_TYPE=2) THEN S.SCHOOL_NAME ELSE '' END AS "schoolName"
        FROM STARCLOUDPORTAL.SCE_INFO_TEACHER T
        LEFT JOIN STARCLOUDPORTAL.SCE_COMMON_USER U ON U.USER_ID= T.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL S ON S.ID=U.ORGANIZATION_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_USER_AUDIT A ON A.ENTITY_ID = S.ID
        WHERE T.USER_ID = #{userId}
    </select>

    <delete id="delPassword">
        update STARCLOUDPORTAL.SCE_COMMON_USER_PASSWORD
        set IS_DELETE = 0
        WHERE USER_ID = #{id}
    </delete>

    <update id="updateOrganizationIdByUserId">
        UPDATE  STARCLOUDPORTAL.SCE_COMMON_USER
        <set>
            <if test="organizationId!=null">
                ORGANIZATION_ID=#{organizationId},
            </if>
            <if test="TEA_ISADMINISTRATORS!=null">
                ISADMINISTRATORS=#{TEA_ISADMINISTRATORS}
            </if>
        </set>
        WHERE USER_ID=#{userId}
    </update>

    <insert id="saveUserAudit" parameterType="cn.com.bonc.sce.bean.UserAuditBean">
        INSERT INTO STARCLOUDPORTAL.SCE_USER_AUDIT
        (ID,USER_ID,USER_TYPE,ENTITY_ID,AUDIT_STATUS)
        VALUES
        (#{id},#{userId},#{userType},#{entityId},#{auditStatus})
    </insert>

    <update id="updateUserAuditById" parameterType="cn.com.bonc.sce.bean.UserAuditBean">
        UPDATE  STARCLOUDPORTAL.SCE_USER_AUDIT
        SET AUDIT_STATUS = #{auditStatus},
            AUDIT_TIME =  NULL ,
            AUDIT_USER_ID = #{auditUserId},
            REJECT_OPINION = #{rejectOpinion}
        WHERE ID=#{id}
    </update>

    <select id="findByUserAuditEntityId" resultType="cn.com.bonc.sce.bean.UserAuditBean">
        SELECT
        T.ID "id",
        T.USER_ID "userId",
        T.USER_TYPE "userType",
        T.AUDIT_STATUS "auditStatus",
        T.AUDIT_TIME "auditTime",
        T.AUDIT_USER_ID "auditUserId",
        T.REJECT_OPINION "rejectOpinion"
        FROM STARCLOUDPORTAL.SCE_USER_AUDIT T
        WHERE ENTITY_ID = #{entityId}
    </select>

    <select id="checkUser" resultType="int">
        select count(1)
        from STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE CERTIFICATE_TYPE = #{certificateType}
        AND CERTIFICATE_NUMBER = #{certificateNumber}
        AND PHONE_NUMBER = #{phoneNumber}
    </select>

    <select id="getTransferTeacherInfo" resultType="Map">
        SELECT U.CERTIFICATE_TYPE,
        U.CERTIFICATE_NUMBER,
        U.USER_NAME,
        U.GENDER,
        U.PHONE_NUMBER,
        U.MAIL_ADDRESS,
        TO_CHAR(U.BIRTHDATE,'YYYY-MM-dd') AS BIRTHDATE,
        U.NATIONALITY AS NATIONLITY,
        U.VOLK AS NATION_CODE,
        T.ACADEMIC_QUALIFICATION,
        T.WORK_NUMBER,
        TO_CHAR(T.TEACH_TIME,'YYYY-MM-dd') AS TEACH_TIME,
        TO_CHAR(T.SCHOOL_TIME,'YYYY-MM-dd') AS SCHOOL_TIME,
        T.POSITION,
        T.TEACH_RANGE,
        ES.SCHOOL_NAME,
        ES2.SCHOOL_NAME AS NEW_SCHOOL_NAME,
        TO_CHAR(TA.ID) AS ID
        FROM STARCLOUDPORTAL.SCE_COMMON_USER U
        LEFT JOIN STARCLOUDPORTAL.SCE_TRANSFER_APPLY TA
        ON U.USER_ID = TA.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_INFO_TEACHER T
        ON T.USER_ID = U.USER_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES
        ON ES.ID = U.ORGANIZATION_ID
        LEFT JOIN STARCLOUDPORTAL.SCE_ENTITY_SCHOOL ES2
        ON ES2.ID = TA.TARGET_SCHOOL_ID
        WHERE U.IS_DELETE = 1
        AND TA.IS_DELETE = 1
        AND T.IS_DELETE = 1
        AND ES.IS_DELETE = 1
        AND TA.ID = TO_NUMBER(#{transferId})
    </select>

    <select id="selectTeacherInfoByTransferId" resultType="Map">
        SELECT USER_ID,
        TO_CHAR(TEA_ENTRANCE_YEAR,'YYYY-MM-dd'),
        TEA_WORK_NUMBER,
        TEA_POSITION,
        TEACH_RANGE
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        WHERE ID = TO_NUMBER(#{transferId})
    </select>

    <update id="updateTeacher">
        UPDATE STARCLOUDPORTAL.SCE_INFO_TEACHER
        <set>
            <if test="TEA_ENTRANCE_YEAR != null and TEA_ENTRANCE_YEAR != ''">
                SCHOOL_TIME = TO_DATE(#{TEA_ENTRANCE_YEAR},'YYYY-MM-dd'),
            </if>
            <if test="TEA_WORK_NUMBER != null and TEA_WORK_NUMBER != ''">
                WORK_NUMBER = #{TEA_WORK_NUMBER},
            </if>
            <if test="TEA_POSITION != null and TEA_POSITION != ''">
                POSITION = #{TEA_POSITION},
            </if>
            <if test="TEACH_RANGE != null and TEACH_RANGE != ''">
                TEACH_RANGE = #{TEACH_RANGE}
            </if>
        </set>
        where USER_ID = #{USER_ID}
    </update>

    <select id="selectCountByCertificateNumber" resultType="int">
        select count(1)
        from STARCLOUDPORTAL.SCE_COMMON_USER
        where CERTIFICATE_TYPE = #{certificateType}
        and CERTIFICATE_NUMBER = #{certificateNumber}
        <if test="userType != null">
            AND USER_TYPE = #{userType}
        </if>
    </select>

    <select id="selectCountByPhoneNumber" resultType="int">
        select count(1)
        from STARCLOUDPORTAL.SCE_COMMON_USER
        where PHONE_NUMBER = #{phoneNumber}
    </select>

    <select id="selectCountByMailAddress" resultType="int">
        select count(1)
        from STARCLOUDPORTAL.SCE_COMMON_USER
        where MAIL_ADDRESS = #{mailAddress}
    </select>

    <select id="selectIsAdministortars" resultType="Integer">
        SELECT ISADMINISTRATORS
        FROM STARCLOUDPORTAL.SCE_COMMON_USER
        WHERE USER_ID = #{userId}
        AND IS_DELETE = 1
    </select>

    <update id="updateAudit">
        UPDATE  STARCLOUDPORTAL.SCE_USER_AUDIT
        <set>
            <if test="auditUserId!=null">
                AUDIT_USER_ID=#{auditUserId},
            </if>
            <if test="auditStatus!=null">
                AUDIT_STATUS=#{auditStatus},
            </if>
            REJECT_OPINION=#{rejectOpinion},
            AUDIT_TIME = sysdate
        </set>
        WHERE USER_ID=#{userId}
    </update>

    <update id="updateInfoTeacher">
        UPDATE  STARCLOUDPORTAL.SCE_INFO_TEACHER
        <set>
            <if test="entityId!=null">
                SCHOOL_ID=#{entityId}
            </if>
        </set>
        WHERE USER_ID=#{userId}
    </update>

    <update id="updateInfoInstitution">
        UPDATE  STARCLOUDPORTAL.SCE_INFO_INSTITUTION
        <set>
            <if test="entityId!=null">
                INSTITUTION_ID=#{entityId}
            </if>
        </set>
        WHERE USER_ID=#{userId}
    </update>

    <update id="updateInfoAgent">
        UPDATE  STARCLOUDPORTAL.SCE_INFO_AGENT
        <set>
            <if test="entityId!=null">
                AGENT_ID=#{entityId}
            </if>
        </set>
        WHERE USER_ID=#{userId}
    </update>

    <select id="getAudit" resultType="cn.com.bonc.sce.bean.UserAuditBean">
        SELECT
        T.AUDIT_STATUS "auditStatus",
        T.REJECT_OPINION "rejectOpinion"
        FROM STARCLOUDPORTAL.SCE_USER_AUDIT T
        WHERE USER_ID = #{userId}
    </select>

    <select id="selectTransferInfoByTransferId" resultType="map">
        SELECT TARGET_SCHOOL_ID AS ORGANIZATION_ID,
        USER_ID,
        TEA_ISADMINISTRATORS
        FROM STARCLOUDPORTAL.SCE_TRANSFER_APPLY
        WHERE ID = TO_NUMBER(#{transferId})
    </select>

    <update id="updateIsadministrators">
        UPDATE  STARCLOUDPORTAL.SCE_COMMON_USER
        SET ISADMINISTRATORS = 1
        WHERE USER_ID=#{userId}
    </update>


    <select id="selectAuthStatus" resultType="int">
        SELECT COUNT(1)
        FROM STARCLOUDPORTAL.SCE_USER_AUDIT
        WHERE USER_ID = #{userId}
        AND AUDIT_STATUS = 1
    </select>
</mapper>